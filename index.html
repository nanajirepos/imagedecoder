
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Image Decoder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      margin: 10px 0;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
    }
    /* One big image per row, stacked vertically */
    .gallery {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 20px;
    }
    .image-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }
    .gallery img {
      max-width: 100%;         /* large, but constrained by page width */
      height: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: block;
    }
    .image-info {
      font-size: 13px;
      color: #555;
      font-family: Consolas, "Courier New", monospace;
    }
  </style>
</head>
<body>
  <h2>Multi-Image Decoder</h2>
  
  <p>Paste text that contains Base64 (Unicode-escaped) inside double quotes. All quoted strings will be scanned.</p>
  <textarea id="input" placeholder='"image1":"\u0049\u006d...",&#10;"image2":"\u0041\u0042\u0043...",'></textarea>
  <br>
  <button onclick="decodeAndShow()">Decode & Show Images</button>
  
  <h3>Decoded Images:</h3>
  <div class="gallery" id="gallery"></div>
  
  <script>
    // Decode \uXXXX unicode escapes into real characters
    function decodeUnicode(str) {
      return str.replace(/\\u([\dA-Fa-f]{4})/g, (match, grp) =>
        String.fromCharCode(parseInt(grp, 16))
      );
    }

    // Main function: find all "...." strings, unicode-decode, treat as Base64 JPEG
    function decodeAndShow() {
      const input   = document.getElementById("input").value;
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = ""; // clear old images

      // Find everything inside double quotes
      const regex = /"([^"]+)"/g;
      let match;
      let found = 0;
      const processed = new Set();

      while ((match = regex.exec(input)) !== null) {
        let raw = match[1];
        if (!raw) continue;

        // First decode unicode escapes like \u0049\u006d...
        let unicodeDecoded = decodeUnicode(raw);

        // Remove whitespace inside the Base64 string
        let base64Str = unicodeDecoded.replace(/\s+/g, "");

        // Skip short strings that are unlikely to be real image Base64
        if (base64Str.length < 100) continue;

        // Avoid rendering duplicates if the same Base64 string appears multiple times
        if (processed.has(base64Str)) continue;
        processed.add(base64Str);

        // Create container for image + resolution info
        const container = document.createElement("div");
        container.className = "image-container";

        const img = document.createElement("img");
        const info = document.createElement("div");
        info.className = "image-info";
        info.textContent = "Resolution: detecting...";

        img.onload = function() {
          info.textContent = "Resolution: " + img.naturalWidth + " x " + img.naturalHeight + " px";
        };

        img.onerror = function() {
          info.textContent = "Failed to load image";
        };

        img.src = "data:image/jpeg;base64," + base64Str;

        container.appendChild(img);
        container.appendChild(info);
        gallery.appendChild(container);

        found++;
      }

      // Additionally, look for standalone Base64-like strings that are not inside double quotes
      // We first unicode-decode the entire input, then search for long Base64-looking runs.
      const unicodeInput = decodeUnicode(input);
      const standaloneRegex = /[A-Za-z0-9+/=]{100,}/g;
      let standaloneMatch;

      while ((standaloneMatch = standaloneRegex.exec(unicodeInput)) !== null) {
        let base64Str = standaloneMatch[0];
        if (!base64Str) continue;

        // Trim whitespace just in case and ensure minimum length
        base64Str = base64Str.replace(/\s+/g, "");
        if (base64Str.length < 100) continue;

        // Skip if we already rendered this Base64 image from the quoted pass
        if (processed.has(base64Str)) continue;
        processed.add(base64Str);

        const container = document.createElement("div");
        container.className = "image-container";

        const img = document.createElement("img");
        const info = document.createElement("div");
        info.className = "image-info";
        info.textContent = "Resolution: detecting...";

        img.onload = function() {
          info.textContent = "Resolution: " + img.naturalWidth + " x " + img.naturalHeight + " px";
        };

        img.onerror = function() {
          info.textContent = "Failed to load image";
        };

        img.src = "data:image/jpeg;base64," + base64Str;

        container.appendChild(img);
        container.appendChild(info);
        gallery.appendChild(container);

        found++;
      }

      if (!found) {
        gallery.textContent = "No suitable Base64-encoded image strings found inside double quotes.";
      }
    }
  </script>
</body>
</html>
